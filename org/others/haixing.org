海星项目概要设计


编制部门：技术中心
版 次 号：1.1
生效日期：2017年05月22日



目录
专有名词定义	1
业务流程介绍	1
产品交互时序	2
注册会员	3
会员登录	4
整体方案简介	4
部署结构	5
数据库设计	5
安全设计	5
模块设计	6
XX模块设计	6
关键时序（产品交互）	6
接口	6
实体类	8
服务类	10
关键业务规则	11
上线方案	12
遗留问题	13
专有名词定义
[可选项，列出本文件中用到的专门术语的定义、缩略语的详细定义、外文首字母组词的原词组]
【示例】：


业务流程介绍
[可选项，如果业务较复杂，涉及到多个系统的交互，可以用涌道图的方式，把主要流程在各系统之间的交互何协助描述出来]
【示例】：

产品交互时序
[可选项，对关键的产品功能进行描述，主要体现用户和系统之间的信息传递，用来推导需要定义的接口以及接口参数，如项目不涉及可不填写]
【示例】：
注册会员


会员登录

整体方案简介
[必填项，简要描述本次修改的系统边界、改了哪些模块、如何改的,没有固定格式，说的明白即可]
【示例】：
本项目修改内容影响二代退款处理流程。
原退款流程：商户通过接口或者后台发起退款-〉创建退款记录-〉扣减商户账户余额-〉结束
注：结算人员查询到退款记录以后，进行人工处理。
修改后的流程：商户通过接口或者后台发起退款-〉创建退款记录-〉扣减商户账户余额-〉调用三代退款接口-〉结束
本次的修改点：主要在于发起退款的最后一步需要调用三代的退款处理接口，修改后，结算人员不再查询二代的退款处理记录，而是登录到三代的结算后台进行处理。和以前的区别在于把退款处理作为一个独立的系统，从业务系统里面剥离出来，无论是自动退款还是人工退款，前端业务系统都不用关心，业务系统只要完成扣商户款，并调用退款处理接口即可，之后退款处理系统会根据退款的银行接口类型，金额，日期等要素来选择一个最合适的处理方式，并且在退款处理完成后会通知业务系统。
部署结构
[可选项，如果涉及到多个系统间的交互，在这里以部署结构图的方式来描述，体现系统的依赖关系即可，如项目不涉及可不填写]
【示例】：


数据库设计
[可选项，是否需要新增库、表、字段，是否需要复制、归档，是否有其他特殊的数据库操作等，如项目不涉及可不填写]
安全设计
[可选项，介绍系统可能面临的安全威胁以及采用了哪些针对性的技术手段]
模块设计
[必填项，分模块描述代码设计，可以先用图来描述模块间关系，如果项目比较简单，也可以不分模块]

XX模块设计
关键时序（产品交互）
 [可选项 ，如果该模块相对复杂，需要在这用顺序图描述关键的流程]
接口
[必填项，列出本次新增或者修改的主要接口，接口参数，返回值，异常等，要描述清楚这个接口做什么事，在什么时候调用]
【示例】：
com.yeepay.g3.facade.trade.OrderFacade.createOrder


实体类
[必填项，列出本次新增或者修改的实体类，如果变更类实体的状态，则要画出状态变迁图，如果变更了其他枚举属性，要描述每个枚举值的含义]
【示例】：

会员表：用来保存会员基本信息和状态。
会员冻结/解冻记录：对会员进行冻结/解冻的操作记录
会员登录标识表：用来标识会员可以使用哪些登录名进行登录的控制。绑定邮箱或绑定手机成功后，在该表中增加一条记录。
会员账户关系：会员与账户的关联关系列表。
会员绑定或认证的记录：
会员绑定邮箱信息：
会员绑定手机信息：
会员绑定即时消息信息：
会员认证身份证信息：
会员认证银行卡信息：
会员认证请求记录：用来保存会员银行卡或身份证认证的请求记录。
会员授权登录信息：OpenID与会员绑定的信息，如果还未绑定会员，则会员ID为空。
会员通知设置：会员的通知设置；
会员群组信息：会员与群组的关系。
会员联系信息：

会员实体中的会员状态：
【示例】：

会员冻结需要特殊处理，会员冻结有两种状态：
业务冻结：禁止账户和交易操作。业务冻结允许叠加，必须把该会员的所有业务冻结操作都解冻后，才能解除业务冻结。
操作冻结：禁止任何操作，包括登录。操作冻结允许叠加，必须把该会员的所有操作冻结记录都解冻后，才能解除操作冻结。

会员实体中的认证状态：
【示例】：


服务类
[必填项，列出本次新增或者修改的主要服务类，包括action，说明修改后的逻辑即可]
【示例】：

关键业务规则
[选填项，用来描述特别复杂的业务逻辑，最好使用活动图加以文字说明，例如退款流程，要考虑防重复检查，退款处理失败，退款重试等，如项目不涉及可不填写]
【示例】：
借贷平衡检查：
将所有会计分录借、贷金额分别进行汇总，并检查借贷金额是否相等；
检查恒等式：借方发生额=贷方发生额

上线方案
[选填项，如果该项目的上线过程需要特殊操作，例如设置系统切换开关，系统试运行，数据迁移，则需要在此做简要描述，等上线阶段再进一步细化，如项目不涉及可不填写]
【示例】：
本次退款迁移案接口上线，即每个银行接口逐次上线，具体方案如下：
在系统中做一个功能切换开关，用来控制是否调用新退款处理系统，并且能够分接口控制。功能上线后，先选取个别交易量较小的银行接口，通过开关切换到新系统，并且让结算人员使用一段时间（2到3天）观察是否有其他问题，确认正常后，再把其余的接口分批依次切换。
注1：开关切换到新系统后，该接口当天可能还有留在老系统的未处理数据，需要告知结算人员，确保这些数据已经被处理完成。
注2：切换到新系统以后，如果因为BUG等原因不得不切回来，这段时间在新系统里面生成的数据不会迁移回老系统，需要手工处理。
遗留问题
[选填项，列出本次设计上可能存在、将来要改进的遗留问题，如项目不涉及可不填写]
【示例】：
对账产生的历史数据每日堆积，数据量过大后可能导致查询性能下降，而这些历史数据在后期被使用的几率很低，可以定期进行归档，需要设计归档方案（可在功能上线后的一个季度内实现）。

